const data = [
  {
    documents: [
      {
        r_name: "아시아음식점",
        r_phone: null,
        r_lon: "127.147516",
        r_lat: "36.808204",
        r_do: "충남",
        r_si: "천안시",
        r_gu: null,
        r_dong: null,
        r_cat: null,
        r_id: "5",
        r_url: null,
        r_image_url:
          "https://dthumb-phinf.pstatic.net/?src=%22https%3A%2F%2Fsearch.pstatic.net%2Fcommon%2F%3FautoRotate%3Dtrue%26quality%3D100%26type%3Df640_380%26src%3Dhttps%253A%252F%252Fldb-phinf.pstatic.net%252F20151104_4%252F1446624021652wtqLw_JPEG%252F167054573040236_0.jpg%22&type=ff500_300",
        c_name: "중국느낌카페",
        c_phone: null,
        c_lon: "127.147729",
        c_lat: "36.809026",
        c_do: "충남",
        c_si: "천안시",
        c_gu: null,
        c_dong: null,
        c_cat: null,
        c_id: "2",
        c_url: null,
        c_image_url: "http://assets.bwbx.io/images/iTVLb._zKs3I/v0/488x-1.jpg",
      },
      {
        r_name: "인도음식점",
        r_phone: null,
        r_lon: "127.148715",
        r_lat: "36.809342",
        r_do: "충남",
        r_si: "천안시",
        r_gu: null,
        r_dong: null,
        r_cat: null,
        r_id: "4",
        r_url: null,
        r_image_url:
          "https://dthumb-phinf.pstatic.net/?src=%22https%3A%2F%2Fsearch.pstatic.net%2Fcommon%2F%3FautoRotate%3Dtrue%26quality%3D100%26type%3Df640_380%26src%3Dhttps%253A%252F%252Fldb-phinf.pstatic.net%252F20151104_4%252F1446624021652wtqLw_JPEG%252F167054573040236_0.jpg%22&type=ff500_300",
        c_name: "볼베어파크 천안점",
        c_phone: "",
        c_lon: "127.150594",
        c_lat: "36.807872",
        c_do: "충남",
        c_si: "천안시",
        c_gu: "동남구",
        c_dong: "문화동",
        c_cat: "키즈카페",
        c_id: "836565346",
        c_url: "http://place.map.kakao.com/836565346",
        c_image_url: "http://assets.bwbx.io/images/iTVLb._zKs3I/v0/488x-1.jpg",
      },
      {
        r_name: "중식당",
        r_phone: null,
        r_lon: "127.147161",
        r_lat: "36.807329",
        r_do: "충남",
        r_si: "천안시",
        r_gu: "동남구",
        r_dong: null,
        r_cat: null,
        r_id: "1",
        r_url: null,
        r_image_url:
          "https://dthumb-phinf.pstatic.net/?src=%22https%3A%2F%2Fsearch.pstatic.net%2Fcommon%2F%3FautoRotate%3Dtrue%26quality%3D100%26type%3Df640_380%26src%3Dhttps%253A%252F%252Fldb-phinf.pstatic.net%252F20151104_4%252F1446624021652wtqLw_JPEG%252F167054573040236_0.jpg%22&type=ff500_300",
        c_name: "일본느낌카페",
        c_phone: null,
        c_lon: "127.149570",
        c_lat: "36.809585",
        c_do: "충남",
        c_si: "천안시",
        c_gu: null,
        c_dong: null,
        c_cat: null,
        c_id: "1",
        c_url: null,
        c_image_url: "http://assets.bwbx.io/images/iTVLb._zKs3I/v0/488x-1.jpg",
      },
      {
        r_name: "아시아음식점",
        r_phone: null,
        r_lon: "127.147516",
        r_lat: "36.808204",
        r_do: "충남",
        r_si: "천안시",
        r_gu: null,
        r_dong: null,
        r_cat: null,
        r_id: "5",
        r_url: null,
        r_image_url:
          "https://dthumb-phinf.pstatic.net/?src=%22https%3A%2F%2Fsearch.pstatic.net%2Fcommon%2F%3FautoRotate%3Dtrue%26quality%3D100%26type%3Df640_380%26src%3Dhttps%253A%252F%252Fldb-phinf.pstatic.net%252F20151104_4%252F1446624021652wtqLw_JPEG%252F167054573040236_0.jpg%22&type=ff500_300",
        c_name: "일본느낌카페",
        c_phone: null,
        c_lon: "127.149570",
        c_lat: "36.809585",
        c_do: "충남",
        c_si: "천안시",
        c_gu: null,
        c_dong: null,
        c_cat: null,
        c_id: "1",
        c_url: null,
        c_image_url: "http://assets.bwbx.io/images/iTVLb._zKs3I/v0/488x-1.jpg",
      },
      {
        r_name: "아시아음식점",
        r_phone: null,
        r_lon: "127.147516",
        r_lat: "36.808204",
        r_do: "충남",
        r_si: "천안시",
        r_gu: null,
        r_dong: null,
        r_cat: null,
        r_id: "5",
        r_url: null,
        r_image_url:
          "https://dthumb-phinf.pstatic.net/?src=%22https%3A%2F%2Fsearch.pstatic.net%2Fcommon%2F%3FautoRotate%3Dtrue%26quality%3D100%26type%3Df640_380%26src%3Dhttps%253A%252F%252Fldb-phinf.pstatic.net%252F20151104_4%252F1446624021652wtqLw_JPEG%252F167054573040236_0.jpg%22&type=ff500_300",
        c_name: "볼베어파크 천안점",
        c_phone: "",
        c_lon: "127.150594",
        c_lat: "36.807872",
        c_do: "충남",
        c_si: "천안시",
        c_gu: "동남구",
        c_dong: "문화동",
        c_cat: "키즈카페",
        c_id: "836565346",
        c_url: "http://place.map.kakao.com/836565346",
        c_image_url: "http://assets.bwbx.io/images/iTVLb._zKs3I/v0/488x-1.jpg",
      },
      {
        r_name: "중식당",
        r_phone: null,
        r_lon: "127.147161",
        r_lat: "36.807329",
        r_do: "충남",
        r_si: "천안시",
        r_gu: "동남구",
        r_dong: null,
        r_cat: null,
        r_id: "1",
        r_url: null,
        r_image_url:
          "https://dthumb-phinf.pstatic.net/?src=%22https%3A%2F%2Fsearch.pstatic.net%2Fcommon%2F%3FautoRotate%3Dtrue%26quality%3D100%26type%3Df640_380%26src%3Dhttps%253A%252F%252Fldb-phinf.pstatic.net%252F20151104_4%252F1446624021652wtqLw_JPEG%252F167054573040236_0.jpg%22&type=ff500_300",
        c_name: "볼베어파크 천안점",
        c_phone: "",
        c_lon: "127.150594",
        c_lat: "36.807872",
        c_do: "충남",
        c_si: "천안시",
        c_gu: "동남구",
        c_dong: "문화동",
        c_cat: "키즈카페",
        c_id: "836565346",
        c_url: "http://place.map.kakao.com/836565346",
        c_image_url: "http://assets.bwbx.io/images/iTVLb._zKs3I/v0/488x-1.jpg",
      },
      {
        r_name: "마운틴피시텔 레스토랑",
        r_phone: "041-555-3612",
        r_lon: "127.148424",
        r_lat: "36.809057",
        r_do: "충남",
        r_si: "천안시",
        r_gu: "동남구",
        r_dong: "대흥동",
        r_cat: "인도음식",
        r_id: "13110298",
        r_url: "http://place.map.kakao.com/13110298",
        r_image_url:
          "https://dthumb-phinf.pstatic.net/?src=%22https%3A%2F%2Fsearch.pstatic.net%2Fcommon%2F%3FautoRotate%3Dtrue%26quality%3D100%26type%3Df640_380%26src%3Dhttps%253A%252F%252Fldb-phinf.pstatic.net%252F20151104_4%252F1446624021652wtqLw_JPEG%252F167054573040236_0.jpg%22&type=ff500_300",
        c_name: "볼베어파크 천안점",
        c_phone: "",
        c_lon: "127.150594",
        c_lat: "36.807872",
        c_do: "충남",
        c_si: "천안시",
        c_gu: "동남구",
        c_dong: "문화동",
        c_cat: "키즈카페",
        c_id: "836565346",
        c_url: "http://place.map.kakao.com/836565346",
        c_image_url: "http://assets.bwbx.io/images/iTVLb._zKs3I/v0/488x-1.jpg",
      },
      {
        r_name: "마녀주방 천안점",
        r_phone: "070-4177-1116",
        r_lon: "127.155689",
        r_lat: "36.817663",
        r_do: "충남",
        r_si: "천안시",
        r_gu: "동남구",
        r_dong: "신부동",
        r_cat: "양식",
        r_id: "1924771438",
        r_url: "http://place.map.kakao.com/1924771438",
        r_image_url:
          "https://postfiles.pstatic.net/MjAyMjA2MDRfMjI3/MDAxNjU0MzM1Njc3ODE2.nEi3X8ZSAl4c13s_pIBQ6D8Hsad8CURfZq90jC4GhYYg.z47t2sEWtfBQWXEua-HOKEtMxlJzwBxdRTkOUyOv7oMg.JPEG.tjfghk0414/%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C_(1).jpg?type=w773",
        c_name: "마녀주방 천안점",
        c_phone: "070-4177-1116",
        c_lon: "127.155689",
        c_lat: "36.817663",
        c_do: "충남",
        c_si: "천안시",
        c_gu: "동남구",
        c_dong: "신부동",
        c_cat: "양식",
        c_id: "1924771438",
        c_url: "http://place.map.kakao.com/1924771438",
        c_image_url:
          "https://postfiles.pstatic.net/MjAyMjA2MDRfMjI3/MDAxNjU0MzM1Njc3ODE2.nEi3X8ZSAl4c13s_pIBQ6D8Hsad8CURfZq90jC4GhYYg.z47t2sEWtfBQWXEua-HOKEtMxlJzwBxdRTkOUyOv7oMg.JPEG.tjfghk0414/%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C_(1).jpg?type=w773",
      },
      {
        r_name: "일식당",
        r_phone: null,
        r_lon: "126.999888",
        r_lat: "36.773001",
        r_do: "충남",
        r_si: "천안시",
        r_gu: null,
        r_dong: null,
        r_cat: null,
        r_id: "2",
        r_url: null,
        r_image_url:
          "https://dthumb-phinf.pstatic.net/?src=%22https%3A%2F%2Fsearch.pstatic.net%2Fcommon%2F%3FautoRotate%3Dtrue%26quality%3D100%26type%3Df640_380%26src%3Dhttps%253A%252F%252Fldb-phinf.pstatic.net%252F20151104_4%252F1446624021652wtqLw_JPEG%252F167054573040236_0.jpg%22&type=ff500_300",
        c_name: "브런치카페",
        c_phone: null,
        c_lon: "126.947718",
        c_lat: "36.864104",
        c_do: "충남",
        c_si: "천안시",
        c_gu: null,
        c_dong: null,
        c_cat: null,
        c_id: "4",
        c_url: null,
        c_image_url: "http://assets.bwbx.io/images/iTVLb._zKs3I/v0/488x-1.jpg",
      },
      {
        r_name: "인도음식점",
        r_phone: null,
        r_lon: "127.148715",
        r_lat: "36.809342",
        r_do: "충남",
        r_si: "천안시",
        r_gu: null,
        r_dong: null,
        r_cat: null,
        r_id: "4",
        r_url: null,
        r_image_url:
          "https://dthumb-phinf.pstatic.net/?src=%22https%3A%2F%2Fsearch.pstatic.net%2Fcommon%2F%3FautoRotate%3Dtrue%26quality%3D100%26type%3Df640_380%26src%3Dhttps%253A%252F%252Fldb-phinf.pstatic.net%252F20151104_4%252F1446624021652wtqLw_JPEG%252F167054573040236_0.jpg%22&type=ff500_300",
        c_name: "일본느낌카페",
        c_phone: null,
        c_lon: "127.149570",
        c_lat: "36.809585",
        c_do: "충남",
        c_si: "천안시",
        c_gu: null,
        c_dong: null,
        c_cat: null,
        c_id: "1",
        c_url: null,
        c_image_url: "http://assets.bwbx.io/images/iTVLb._zKs3I/v0/488x-1.jpg",
      },
    ],
    meta: {
      total_count: 46,
      is_end: false,
      pageable_count: 45,
      same_name: null,
    },
  },
];

// console.log('바로실행');

//   const req = {
//     u_id: userId.value,
//     u_pw: userPw.value,
//     u_nick: userNick.value,
//     birth: birthYear.value + "-" + birthMonth.value + "-" + birthDay.value,
//     gender: document.querySelector('input[name="gender"]:checked').value,
//   };
//   console.log(req);
//   console.log(JSON.stringify(req));
//   fetch("/signttt", {
//     method: "POST",
//     headers: { "Content-Type": "application/json" },
//     body: JSON.stringify(req),
//   })
//     .then((response) => response.json())
//     .then((data) => {
//       console.log("response : " + data + " TYPE : " + typeof data);
//       if (Number(data) == 1) {
//         // form.submit();
//         //goreplace(/sign/signUp);
//       } else {
//         alert("다시 확인해!!!!");
//       }
//     });

const h1 = document.getElementsByTagName("h1");
const cafeRoadAddress = document.getElementsByClassName("road_address");
const cafeAddress = document.getElementsByClassName("address");
const phoneNum = document.getElementsByClassName("phone");
const dateInfo = data[0]["documents"];

//마커를 담을 배열
let markers = [];
let polylines = [];

const ingiDo = document.getElementById("ingi-do");
const ingiSi = document.getElementById("ingi-si");
// 페이지 접속하자마자 실행할 수 있도록 DOMContentLoaded 이벤트 생성
window.addEventListener("DOMContentLoaded", () => {
  console.log("바로실행");
  fetch("/popularCourse/getDo", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
  })
    .then((response) => response.json())
    .then((data) => {
      console.log("response : " + data);

      // select -> do
      const testData = ["전체", "충남", "아산", "충북", "전남"];
      console.log(testData);

      isDoOptionExisted = false;
      ingiDo.addEventListener("focus", () => {
        if (!isDoOptionExisted) {
          isDayOptionExisted = true;
          for (let i = 1; i < testData.length; i++) {
            const DoOption = document.createElement("option");

            DoOption.setAttribute("value", testData[i]);
            DoOption.innerText = testData[i];
            ingiDo.appendChild(DoOption);
          }
        }

        // 여기에 fetch 적용해서 해당 value에 해당하는 데이터 받아와야 함
      });
    });
});

// 지도에 표시할 선을 생성합니다
function addPolyline(firstPosition, secondPosition, idx) {
  linePath = [firstPosition, secondPosition];

  let polyline = new kakao.maps.Polyline({
    path: linePath, // 선을 구성하는 좌표배열 입니다
    strokeWeight: 5, // 선의 두께 입니다
    strokeColor: "#FF5757", // 선의 색깔입니다
    strokeOpacity: 0.7, // 선의 불투명도 입니다 1에서 0 사이의 값이며 0에 가까울수록 투명합니다
    strokeStyle: "solid", // 선의 스타일입니다
  });
  polyline.setMap(map);
  polylines.push(polyline);
  
  return polyline;
}

function removePolyline() {
  for (let i = 0; i < polylines.length; i++) {
    polylines[i].setMap(null);
  }
  markers = [];
}

// 마커를 생성하고 지도 위에 마커를 표시하는 함수입니다
function addMarker(position, idx, title) {
  var imageSrc = "../images/marker_img.png",
    imageSize = new kakao.maps.Size(52, 57),
    imageOption = { offset: new kakao.maps.Point(25, 55) };

  var markerImage = new kakao.maps.MarkerImage(
    imageSrc,
    imageSize,
    imageOption
  );
  marker = new kakao.maps.Marker({
    position: position, // 마커의 위치
    image: markerImage,
  });

  marker.setMap(map); // 지도 위에 마커를 표출합니다
  markers.push(marker); // 배열에 생성된 마커를 추가합니다

  map.panTo(position);
  return marker;
}

// 지도 위에 표시되고 있는 마커를 모두 제거합니다
function removeMarker() {
  for (var i = 0; i < markers.length; i++) {
    markers[i].setMap(null);
  }
  markers = [];
}

for (let i = 0; i < dateInfo.length; i++) {
  // 끼야아아아악 힘들어 죽는줄~~~~~~~~~~~~~~~
  let r_address =
    dateInfo[i].r_do +
    " " +
    dateInfo[i].r_si +
    " " +
    dateInfo[i].r_gu +
    " " +
    dateInfo[i].r_dong;

  let c_address =
    dateInfo[i].c_do +
    " " +
    dateInfo[i].c_si +
    " " +
    dateInfo[i].c_gu +
    " " +
    dateInfo[i].c_dong;

  let choiceEl = document.createElement("div"),
    itemStr =
      "<div>" +
      "<div class='ingi-list__description'>" +
      "<h5 class='first'>" +
      dateInfo[i].r_name +
      "</h5>" +
      "<div class='first__item'>" +
      "<span class='first__description'>" +
      r_address +
      "</span>";

  if (dateInfo[i].r_phone) {
    itemStr += "<span class='tel'>" + dateInfo[i].r_phone + "</span>";
  }
  itemStr +=
    "</div>" +
    "</div>" +
    "</div>" +
    "<div>" +
    "<div class='ingi-list__description'>" +
    "<h5 class='second'>" +
    dateInfo[i].c_name +
    "</h5>" +
    "<div class='second__item'>" +
    "<span class='second__description'>" +
    c_address +
    "</span>";

  if (dateInfo[i].c_phone) {
    "<span class='tel'>" + dateInfo[i].c_phone + "</span>";
  }

  itemStr += "</div>" + "</div>" + "</div>";

  choiceEl.innerHTML = itemStr;
  choiceEl.className = "ingi-list";

  const area = document.getElementById("items");
  area.appendChild(choiceEl);
  // 아이템 띄우기 끝

  // 아이템 클릭 이벤트 시작
  const ingiList = document.getElementsByClassName("ingi-list");
  ingiList[i].addEventListener("click", () => {
    removeMarker();
    removePolyline();
    // 레스트랑 마커 시작
    console.log("레스토랑: " + dateInfo[i].r_lat + ", " + dateInfo[i].r_lon);
    let firstPosition = new kakao.maps.LatLng(
        dateInfo[i]["r_lat"],
        dateInfo[i]["r_lon"]
      ),
      firstMessage = dateInfo[i]["r_name"];

    console.log(firstPosition, firstMessage);
    addMarker(firstPosition, i);
    // displayMarker(firstPosition, firstMessage);
    // 레스트랑 마커 끝

    // 카페 마커 시작
    // removeMarker();
    console.log("카페: " + dateInfo[i].c_lat + ", " + dateInfo[i].c_lon);
    let secondPosition = new kakao.maps.LatLng(
        dateInfo[i]["c_lat"],
        dateInfo[i]["c_lon"]
      ),
      secondMessage = dateInfo[i]["c_name"];

    console.log(secondPosition, secondMessage);
    addMarker(secondPosition, i);
    // displayMarker(secondPosition, secondMessage);
    // 카페 마커 끝
    console.log("first: " + firstPosition + ", second: " + secondPosition);

    // 식당, 카페 폴리라인 연결
    addPolyline(firstPosition, secondPosition, i);
  });

  // 아이템 클릭 이벤트 끝
}
